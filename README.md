# 建築圖檔上傳和解析功能

本功能允許用戶上傳 DWG 或 IFC 格式的建築圖檔，從中提取建築信息，並將這些信息結構化儲存到資料庫中，以便後續使用。

## 功能概述

1. **支援的檔案格式**：
   - DWG (AutoCAD 圖形檔案格式)
   - IFC (建築資訊模型的行業基礎類別格式)

2. **主要功能**：
   - 上傳 DWG/IFC 檔案
   - 自動解析檔案並提取建築資訊
   - 將解析結果以表格形式呈現
   - 儲存解析結果到資料庫

3. **提取的建築資訊**：
   - 樓層資訊（樓層編號、高度、面積）
   - 單位資訊（單位編號、高度、面積）
   - 房間資訊（房間編號、長度、深度、高度、面積、窗戶位置）

## 使用步驟

1. **創建新專案**：
   - 先在系統中創建一個新專案，填寫專案名稱和地址
   - 系統會自動創建一個專案 ID

2. **上傳建築圖檔**：
   - 點擊「上傳」按鈕選擇 DWG 或 IFC 檔案
   - 檔案上傳成功後，系統會顯示上傳狀態

3. **解析檔案**：
   - 上傳成功後，點擊「解析檔案」按鈕
   - 系統會自動解析檔案並提取相關建築資訊

4. **檢視解析結果**：
   - 系統會以表格形式顯示解析出的樓層、單位和房間資訊
   - 可以檢查這些資訊是否正確

5. **儲存解析結果**：
   - 確認資訊無誤後，點擊「儲存資料」按鈕
   - 系統會將解析結果儲存到資料庫中

## 系統要求

### 安裝 LibreDWG (用於解析 DWG 文件)

#### macOS 安裝方法

使用 Homebrew 安裝：

```bash
brew install libredwg
```

或從源碼編譯：

```bash
git clone --recurse-submodules https://github.com/LibreDWG/libredwg.git
cd libredwg
mkdir build
cd build
cmake ..
make
sudo make install
```

#### Windows 安裝方法

1. 從 [LibreDWG GitHub Releases](https://github.com/LibreDWG/libredwg/releases) 下載最新的 Windows 二進制文件
2. 解壓縮到系統路徑（例如放入 PATH 環境變數所包含的目錄）

### IFC 解析

IFC 是一種開放標準的文字檔案格式，用於描述建築和施工行業的資料。它是由 buildingSMART 組織開發和維護的國際標準（ISO 16739-1:2024）。

IFC 格式提供了以下優點：
- 跨平台兼容性
- 供應商中立
- 支持完整的建築生命週期資訊
- 國際標準化

## 資料結構

解析後的資料會以下列結構存儲：

1. **樓層 (GBD_Project_floors)**：
   - 樓層編號
   - 高度
   - 面積
   - 座標資訊

2. **單位 (GBD_Project_units)**：
   - 所屬樓層
   - 單位編號
   - 高度
   - 面積
   - 座標資訊

3. **房間 (GBD_Project_rooms)**：
   - 所屬單位
   - 房間編號
   - 長度
   - 深度
   - 高度
   - 面積
   - 窗戶位置
   - 座標資訊

## 常見問題

**Q: 為什麼我上傳的 DWG 檔案解析失敗？**

A: 請確認您的 DWG 檔案是有效的 AutoCAD 檔案，並且系統已正確安裝 LibreDWG。如果問題持續，可能是檔案版本過新或格式特殊，請嘗試使用較舊版本的 AutoCAD 儲存檔案。

**Q: 我可以編輯解析後的資料嗎？**

A: 目前系統只支援顯示和儲存解析後的資料，不支援直接編輯。如需編輯，請在資料儲存後使用其他功能進行修改。

**Q: 如何查看之前上傳解析的專案資料？**

A: 可以在「歷史專案」頁面中查看和載入之前儲存的專案資料。

## 技術資訊

本功能使用以下技術：

- LibreDWG: 用於解析 DWG 檔案
- 純文字解析: 用於解析 IFC 檔案
- AJAX: 實現與伺服器的非同步通訊
- PDO: 安全地操作 SQL Server 資料庫

## 未來發展

計劃在未來版本中添加以下功能：

1. 支援更多建築圖檔格式
2. 增強解析準確度和支援的圖元類型
3. 添加解析後資料的編輯功能
4. 添加 3D 視覺化展示
5. 支援批量導入和匯出功能 