# 🤖 Gemini AI 平面圖分析設置指南

本系統已整合 Google Gemini 2.0 Flash 模型，可自動分析建築平面圖並提取詳細的建築資訊。

## 📋 功能特色

- **智慧圖像識別**：使用 Gemini 2.0 Flash 分析平面圖
- **詳細資訊提取**：自動識別樓層、單元、房間、牆面和窗戶
- **方位識別**：準確判斷牆面和窗戶的朝向
- **面積計算**：自動計算各區域和窗戶面積
- **表格自動填入**：分析結果直接填入綠建築計算表格

## 🚀 快速設置

### 步驟 1: 獲取 Gemini API Key

1. 前往 [Google AI Studio](https://ai.google.dev/api_key)
2. 使用 Google 帳號登入
3. 點選「Get API key」
4. 創建新的 API key 或使用現有的
5. 複製您的 API Key

### 步驟 2: 配置 API Key

#### 方法 A: 使用環境變數（推薦）

在您的系統中設置環境變數：

```bash
# macOS/Linux
export GEMINI_API_KEY="your_actual_api_key_here"

# Windows
set GEMINI_API_KEY=your_actual_api_key_here
```

#### 方法 B: 使用配置文件

1. 複製配置模板：
   ```bash
   cp config/gemini_config.php.example config/gemini_config.php
   ```

2. 編輯 `config/gemini_config.php`：
   ```php
   $GEMINI_API_KEY = 'your_actual_api_key_here';
   ```

### 步驟 3: 測試設置

1. 前往綠建築計算頁面
2. 選擇「平面圖上傳」方式
3. 上傳一張建築平面圖（JPG、PNG 或 GIF）
4. 點選「Gemini AI 分析」
5. 系統會自動分析並填入表格

## 📝 使用說明

### 支援的檔案格式
- **圖像格式**：JPG、PNG、GIF
- **檔案大小**：最大 10MB
- **建議解析度**：至少 800x600 像素

### 分析結果包含
- **樓層資訊**：樓層數量和面積
- **單元劃分**：各單元的配置和面積
- **房間詳情**：
  - 房間名稱和類型（客廳、臥室、廚房等）
  - 尺寸（長、寬、高）
  - 面積計算
- **牆面資訊**：
  - 各面牆的方位（東、西、南、北）
  - 牆面面積
- **窗戶資訊**：
  - 窗戶位置和方位
  - 窗戶尺寸和面積

### 手動調整

分析完成後，您可以在表格中手動調整：
- 修正房間名稱和類型
- 調整尺寸數據
- 補充或修改方位資訊
- 更新面積計算

## ⚙️ 進階配置

### API 參數調整

您可以在 `config/gemini_config.php` 中調整 API 參數：

```php
$GEMINI_CONFIG = [
    'temperature' => 0.1,     // 創造性程度（0-1）
    'topP' => 0.8,           // 核心採樣
    'topK' => 10,            // 候選詞數量
    'maxOutputTokens' => 8192, // 最大輸出長度
    'timeout' => 60          // 請求超時時間（秒）
];
```

### 自定義分析提示詞

如需調整分析行為，可修改 `floorplan_upload.php` 中的 `buildAnalysisPrompt()` 函數。

## 🔧 故障排除

### 常見問題

**Q: 出現 "請設置 Gemini API Key" 錯誤**
A: 確保已正確設置環境變數或配置文件中的 API Key

**Q: API 請求超時**
A: 
- 檢查網路連線
- 嘗試較小的圖檔
- 增加 timeout 設定

**Q: 分析結果不準確**
A: 
- 確保平面圖清晰且有標示
- 手動調整分析結果
- 使用更高解析度的圖檔

**Q: 出現 "Gemini API錯誤" **
A: 
- 檢查 API Key 是否有效
- 確認 API 配額未用完
- 查看詳細錯誤訊息

### 除錯模式

檢查瀏覽器的開發者工具（F12）中的 Console 標籤，查看詳細的分析結果和錯誤訊息。

## 💡 最佳實踐

1. **圖像品質**：使用清晰、高對比度的平面圖
2. **標示完整**：確保房間有中文標示
3. **格式統一**：使用標準的建築圖紙格式
4. **逐步驗證**：上傳後檢查並手動調整結果
5. **備份數據**：定期備份分析結果

## 🔒 安全考量

- 請勿將 API Key 提交到版本控制
- 定期更換 API Key
- 限制 API 使用配額
- 注意敏感建築資料的保護

## 📞 技術支援

如遇到技術問題，請檢查：
1. API Key 設置是否正確
2. 網路連線是否正常
3. 圖檔格式和大小是否符合要求
4. 瀏覽器控制台是否有錯誤訊息

---

🚀 **開始使用 Gemini AI 平面圖分析，讓您的綠建築計算更智慧、更準確！** 